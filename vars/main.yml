---
# vars file for ap-application-load-balancer
alb_version: "v0.7.4-alpha"
alb_version_lastrun: -1

### ALB Internal Variables: Mixed usage ________________________________________

# alb_trusted_ips: "{% set myList = [1,5,3,4,2] %}"
# alb_trusted_ips: "{{ alb_dmz | default([]) + alb_bastion_hosts | default([]) + alb_jump_boxes | default([])}}"
alb_trusted_hosts: "{{ alb_dmz + alb_bastion_hosts + alb_jump_boxes }}"
alb_trusted_hosts_ips: "{{ alb_trusted_hosts | map(attribute='ip') | list }}"

### ALB Internal Variables: Component HAProxy __________________________________

# This variable is used to calculate if we really can enable HAProxy Stats on this host
alb_haproxy_stats_safetoenable: "{{ alb_haproxy_stats_enabled is defined and alb_haproxy_stats_enabled is sameas true }}"
alb_haproxy_stats_authcredentials: "{{ alb_auth_users }}"
alb_haproxy_stats_realm_escaped: "{{ alb_haproxy_stats_realm | regex_replace(' ', '\\ ') }}" # HAproxy requires escape " " with "\ "
# alb_haproxy_stats_realm: "{{ alb_haproxy_stats_realm | regex_replace(' ', '\\\\_') }}" # HAproxy requires escape " " with "\ "
# alb_haproxy_stats_realm: "{{ alb_haproxy_stats_realm.split(' ').join('\ ') }}" # HAproxy requires escape " " with "\ "
# alb_haproxy_stats_realm: "{{ alb_haproxy_stats_realm | split(' ') | join('\ ') }}" # HAproxy requires escape " " with "\ "


### ALB Internal Variables: Facts ______________________________________________

# This result will be stored at /etc/ansible/facts.d/alb_ufw.fact
alb_apps_facts:
  alb_apps: "{{ alb_apps | default(None) }}"

# This result will be stored at /etc/ansible/facts.d/alb_ufw.fact
#alb_common_facts:
#  common_tasks:
#    - "install aptitude"
#    - "hostnamectl set-hostname inventory_hostname_short"
#    - "timedatectl set-timezone UTC"
#    - "mkdir -p /etc/ansible/facts.d/"

alb_haproxy_facts:
  ip: "{{ alb_haproxy_ip }}"
  httpport: "{{ alb_haproxy_httpport }}"
  httpsport: "{{ alb_haproxy_httpsport }}"
  stats_enabled: "{{ alb_haproxy_stats_enabled }}"
  stats_safetoenable: "{{ alb_haproxy_stats_safetoenable }}"
  stats_ip: "{{ alb_haproxy_stats_ip }}"
  stats_port: "{{ alb_haproxy_stats_port }}"
  stats_uri: "{{ alb_haproxy_stats_uri }}"
  stats_realm: "{{ alb_haproxy_stats_realm }}"
  trusted_hosts_ips: "{{ alb_trusted_hosts_ips }}"
  openresty_ip: "{{ alb_openresty_ip }}"
  openresty_httpport: "{{ alb_openresty_httpport }}"
  openresty_httpsport: "{{ alb_openresty_httpsport }}"

# This result will be stored at /etc/ansible/facts.d/alb_ufw.fact
alb_lastrun_facts:
  alb_version: "{{ alb_version }}"
  alb_date_time: "{{ ansible_date_time.iso8601 }}"
  alb_manange:
    alb_manange_all: "{{ alb_manange_all | default(None) }}"
    alb_manange_haproxy: "{{ alb_manange_haproxy | default(None) }}"
    alb_manange_openresty: "{{ alb_manange_openresty | default(None) }}"
    alb_manange_common: "{{ alb_manange_common | default(None) }}"
    alb_manange_sanitycheck: "{{ alb_manange_sanitycheck | default(None) }}"
    alb_manange_apps: "{{ alb_manange_sanitycheck | default(None) }}"
    alb_manange_logrotate: "{{ alb_manange_sanitycheck | default(None) }}"


  # This result will be stored at /etc/ansible/facts.d/alb_ufw.fact
alb_ufw_facts:
  alb_ufw_rules: "{{ alb_ufw_rules | default(None) }}"
  alb_ufw_rules_always: "{{ alb_ufw_rules_always | default(None) }}"
  alb_dmz: "{{ alb_dmz | default(None) }}"
  alb_bastion_hosts: "{{ alb_bastion_hosts | default(None) }}"
  alb_jump_boxes: "{{ alb_jump_boxes | default(None) }}"