---
# FILE: {{ role_path }}/defaults/main.yml

alb_name: "AP Application Load Balancer"
alb_hide_alb: yes
alb_forcedebug: no

alb_apps: []

alb_letsencrypt_allow_domain_whitelist:
#  - example.org
#  - example.com

alb_letsencrypt_allow_domain_blacklist:
#  - baddomain.com
#  - oldexpireddomain.com

alb_letsencrypt_allow_domain_customlua: |
  # FILE: /usr/local/openresty/nginx/conf/nginx.conf
  # NGINX CONTEXT: http/init_by_lua_block/auto_ssl:set("allow_domain", function(domain)
  # See https://github.com/GUI/lua-resty-auto-ssl

alb_letsencrypt_allow_domain_default: "return true"
# alb_letsencrypt_default: "return false"

# alb_apps_serverblock_template is deprecated
alb_apps_serverblock_template: '{{ role_path }}/templates/openresty/nginx/conf/vhosts/static-site.conf.j2'

# Note: at this moment, only "file" implemented. But later "syslog" could be one option
alb_logs_method: "file"

# TODO: considerar implementar logrotate (fititnt, 2019-07-28 23:00 BRT)
alb_logs_path: "/var/log/alb"

### NGinx (OpenResty) __________________________________________________________
alb_nginxconf_template: "{{ role_path }}/templates/openresty/nginx/conf/nginx.conf.j2"

# If you use "{{ role_path }}/templates/openresty/nginx/conf/nginx.conf.j2"
# and not a very customized nginx.conf, you can customize with these variables

alb_nginx_user: "www-data"

# See {{ role_path }}/templates/openresty/nginx/conf/nginx.conf.j2
alb_nginx_maincontext_custom: |
  # FILE: /usr/local/openresty/nginx/conf/nginx.conf
  # NGINX CONTEXT: main (global)
  # Change-me with variable alb_nginx

alb_nginx_eventscontext_custom: |
  # FILE: /usr/local/openresty/nginx/conf/nginx.conf
  # NGINX CONTEXT: events
  # Change-me with variable alb_nginx_eventscontext_custom

alb_nginx_httpcontext_custom: |
  # FILE: /usr/local/openresty/nginx/conf/nginx.conf
  # NGINX CONTEXT: events
  # Change-me with variable alb_nginx_eventscontext_custom
  

### vnStat _____________________________________________________________________
# @see https://humdi.net/vnstat/
# @see https://www.howtoforge.com/tutorial/vnstat-network-monitoring-ubuntu/



### Application Load Balancer - Internal Use ___________________________________
# If you are creating custom ALB Rules (e.g. OpenResty Server Blocks) you will
# need to consider these rules

## Uncoment next line to use acme staging (for test Let's Encrypt)
# See https://letsencrypt.org/docs/staging-environment/
# alb_letsencrypt_acmeurl_custom: "https://acme-staging-v02.api.letsencrypt.org/directory"

alb_apprule_automatichttps_httpsblock: |
  ## Automatic HTTPS / 443 port (DO NOT REMOVE) - Start
  # Fallback certificate
  ssl_certificate /etc/ssl/resty-auto-ssl-fallback.crt;
  ssl_certificate_key /etc/ssl/resty-auto-ssl-fallback.key;

  # Real certificate
  ssl_certificate_by_lua_block {
    auto_ssl:ssl_certificate()
  }

  #  Let's Encrypt acme-challenge
  location /.well-known/acme-challenge/ {
    content_by_lua_block {
      auto_ssl:challenge_server()
    }
  }
  ## Automatic HTTPS / 443 port (DO NOT REMOVE) - Start

alb_apprule_automatichttp_httpsblock: |
  ## Automatic HTTPS / :80 port (DO NOT REMOVE) - Start
  #  Let's Encrypt acme-challenge
  location /.well-known/acme-challenge/ {
    content_by_lua_block {
      auto_ssl:challenge_server()
    }
  }
  ## Automatic HTTPS / :80 port (DO NOT REMOVE) - Start

### Defaults ___________________________________________________________________
# @TODO rewrite alb-strategies to support these defaults (fititnt, 2019-11-02 20:40 BRT)
alb_default_app_domain: "localhost"
alb_default_app_root: "/var/www/html"
alb_default_app_forcehttps: no
alb_default_app_state: present
alb_default_app_alb_strategy: "files-local"
alb_default_app_php_socket_path: "/run/php/php7.3-fpm.sock"

### AP-ALB , PHP (suggestions for external roles) ______________________________
alb_strategy_socket_php__defaultsocket: "/run/php/php7.3-fpm.sock"

## Internal use / Placeholder tags _____________________________________________
alb_openresty_httpport: 8080
alb_openresty_httpsport: 4443
alb_haproxy_httpport: 80
alb_haproxy_httpsport: 443
alb_haproxy_haproxy_template: "{{ role_path }}/files/haproxy-minimal.cfg.j2"

#
alb_forceignore_haproxy: false
alb_forceignore_openresty: false
alb_forceignore_ufw: false
